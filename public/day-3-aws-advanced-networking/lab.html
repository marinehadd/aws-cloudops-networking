<!DOCTYPE html>
<html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta property="og:title" content="https://networking.aws-cloudops.com" />s
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://networking.aws-cloudops.com/" />
    <meta property="og:image" content="https://networking.aws-cloudops.com/images/routericon.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.80.0" />
    <meta name="description" content="Amazon CloudOps Networking Workshop">
<meta name="author" content="Marine Haddad">

    <link rel="icon" href="../images/favicon.png" type="image/png">

    <title>VPC Peering LAB :: Amazon CloudOps Networking Workshop</title>

    
    <link href="../css/nucleus.css?1615889543" rel="stylesheet">
    <link href="../css/all.css?1615889543" rel="stylesheet">
    <link href="../css/hybrid.css?1615889543" rel="stylesheet">
    <link href="../css/featherlight.min.css?1615889543" rel="stylesheet">
    <link href="../css/perfect-scrollbar.min.css?1615889543" rel="stylesheet">
    <link href="../css/auto-complete.css?1615889543" rel="stylesheet">
    <link href="../css/theme.css?1615889543" rel="stylesheet">
    <link href="../css/hugo-theme.css?1615889543" rel="stylesheet">
    <link href="../css/jquery-ui.min.css?1615889543" rel="stylesheet">
    
      <link href="../css/theme-mine.css?1615889543" rel="stylesheet">
    

    <script src="../js/jquery-3.3.1.min.js?1615889543"></script>
    <script src="../js/jquery-ui-1.12.1.min.js?1615889543"></script>


    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="../day-3-aws-advanced-networking/lab.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="../" title="Go home"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 30" width="60%" style="padding:20px 0px;"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js?1615889543"></script>
<script type="text/javascript" src="../js/auto-complete.js?1615889543"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../js/search.js?1615889543"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction.html" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="../introduction.html">
          Introduction
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/day-1-networking-foundations.html" title="Networking Fundamentals" class="dd-item 
        
        
        
        ">
      <a href="../day-1-networking-foundations.html">
          Networking Fundamentals
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/network-definition.html" title="What is a network?" class="dd-item ">
        <a href="../day-1-networking-foundations/network-definition.html">
        What is a network?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/osi-model.html" title="OSI Model" class="dd-item ">
        <a href="../day-1-networking-foundations/osi-model.html">
        OSI Model
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/subnetting.html" title="Subnetting" class="dd-item ">
        <a href="../day-1-networking-foundations/subnetting.html">
        Subnetting
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/routing.html" title="Routing" class="dd-item ">
        <a href="../day-1-networking-foundations/routing.html">
        Routing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/dnsdhcp.html" title="DNS/DHCP" class="dd-item ">
        <a href="../day-1-networking-foundations/dnsdhcp.html">
        DNS/DHCP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-1-networking-foundations/homework.html" title="Homework" class="dd-item ">
        <a href="../day-1-networking-foundations/homework.html">
        Homework
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/day-2-aws-networking-basics.html" title="AWS Networking basics" class="dd-item 
        
        
        
        ">
      <a href="../day-2-aws-networking-basics.html">
          AWS Networking basics
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/aws-infrastructure.html" title="AWS Infrastructure" class="dd-item ">
        <a href="../day-2-aws-networking-basics/aws-infrastructure.html">
        AWS Infrastructure
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/whats-a-vpc.html" title="What is a VPC?" class="dd-item ">
        <a href="../day-2-aws-networking-basics/whats-a-vpc.html">
        What is a VPC?
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/privatepublic.html" title="Private/Public concepts" class="dd-item ">
        <a href="../day-2-aws-networking-basics/privatepublic.html">
        Private/Public concepts
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/security.html" title="Security in a VPC" class="dd-item ">
        <a href="../day-2-aws-networking-basics/security.html">
        Security in a VPC
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/load-balancing.html" title="Elastic Load Balancing" class="dd-item ">
        <a href="../day-2-aws-networking-basics/load-balancing.html">
        Elastic Load Balancing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/lab.html" title="ELB LAB" class="dd-item ">
        <a href="../day-2-aws-networking-basics/lab.html">
        ELB LAB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-2-aws-networking-basics/route53.html" title="Route53" class="dd-item ">
        <a href="../day-2-aws-networking-basics/route53.html">
        Route53
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/day-3-aws-advanced-networking.html" title="AWS Advanced Networking" class="dd-item 
        parent
        
        
        ">
      <a href="../day-3-aws-advanced-networking.html">
          AWS Advanced Networking
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/day-3-aws-advanced-networking/hybrid-cloud.html" title="Hybrid Connectivity" class="dd-item ">
        <a href="../day-3-aws-advanced-networking/hybrid-cloud.html">
        Hybrid Connectivity
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-3-aws-advanced-networking/vpc-peering.html" title="VPC Peering" class="dd-item ">
        <a href="../day-3-aws-advanced-networking/vpc-peering.html">
        VPC Peering
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-3-aws-advanced-networking/lab.html" title="VPC Peering LAB" class="dd-item active">
        <a href="../day-3-aws-advanced-networking/lab.html">
        VPC Peering LAB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-3-aws-advanced-networking/transit-gateway.html" title="Transit Gateway" class="dd-item ">
        <a href="../day-3-aws-advanced-networking/transit-gateway.html">
        Transit Gateway
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/day-3-aws-advanced-networking/vpc-endpoints.html" title="VPC Endpoints" class="dd-item ">
        <a href="../day-3-aws-advanced-networking/vpc-endpoints.html">
        VPC Endpoints
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/lab_diagram.html" title="Lab Architecture" class="dd-item 
        
        
        
        ">
      <a href="../lab_diagram.html">
          Lab Architecture
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/further_reading.html" title="Further Reading" class="dd-item 
        
        
        
        ">
      <a href="../further_reading.html">
          Further Reading
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/faq.html" title="FAQs" class="dd-item 
        
        
        
        ">
      <a href="../faq.html">
          FAQs
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/marine-haddad-38a542b5/"><i class='fab fa-linkedin fa-lg'></i> Marine Haddad</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/adrianna-kurzela-26b88210b/"><i class='fab fa-linkedin fa-lg'></i> Adrianna Kurzela</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <left>

    

    <a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2021, Amazon Web Services, Inc. or its affiliates. All rights reserved. 

</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/marinehadd/aws-cloudops-networking/edit/master/content/Day%203%20-%20AWS%20Advanced%20Networking/LAB.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../'>Welcome to the Amazon CloudOps Networking Workshop!</a> > <a href='../day-3-aws-advanced-networking.html'>AWS Advanced Networking</a> > VPC Peering LAB
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents"></nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>VPC Peering LAB</h1>
          

        


<p>In this lab, you will create a VPC Peering connection between 2 VPCs and allow their resources to communicate across.</p>
<p>For that, you will need to launch 2 VPCs and a VPC peering connection, and to launch EC2 instances in each VPC with private connectivity between instances.</p>
<img src='../images/peering.png' width='600px'>
<p><strong>Create a VPC 1:</strong></p>
<ul>
<li>Login to your AWS account</li>
<li>Go to VPC Services and on the left panel, click on <em>Your VPCs</em></li>
<li>Click on <em>Create VPC</em> and give it a name (i.e. VPC-1) and a /16 CIDR block (i.e. 10.100.0.0/16), then leave the rest as default and click <em>Create VPC</em></li>
<li>Go back to the <em>Your VPCs</em> tab and check that your VPC has been created</li>
</ul>
<p><strong>Create a public subnet 1:</strong></p>
<ul>
<li>Go to VPC Services and on the left panel, click on <em>Subnets</em></li>
<li>Click on <em>Create Subnet</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PublicSub-1)</li>
<li>choose one of the Availability Zones</li>
<li>Use the first /24 of your VPC CIDR (i.e. 10.100.0.0/24)</li>
<li>Click <em>Create Subnet</em></li>
</ul>
</li>
</ul>
<p>Now, your subnet is setup but can only communicate within the VPC by default.</p>
<p><strong>Create a private subnet 1:</strong></p>
<ul>
<li>Go to VPC Services and on the left panel, click on <em>Subnets</em></li>
<li>Click on <em>Create Subnet</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PrivateSub-1)</li>
<li>choose one of the Availability Zones</li>
<li>Use the first /24 of your VPC CIDR (i.e. 10.100.1.0/24)</li>
<li>Click <em>Create Subnet</em></li>
</ul>
</li>
</ul>
<p>Now, your subnet is setup but can only communicate within the VPC by default.</p>
<p><strong>Create a public route table:</strong></p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em></li>
<li>Click on <em>Create Route Table</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PublicRT-1)</li>
<li>Click <em>Create</em></li>
</ul>
</li>
<li>On the Route Tables interface, look for your route table:
<ul>
<li>select the route table</li>
<li>on the panel at the bottom, click on <em>Subnet Associations</em></li>
<li><em>Edit subnet associations</em> and select your public subnet 1 and <em>Save</em></li>
</ul>
</li>
</ul>
<p>Now, you have a public route table that will be used to route all external (such as Internet) traffic to and from your public subnet. However, we still don&rsquo;t know how to go to the Internet as we have no exit door yet.</p>
<p><strong>Create an Internet Gateway:</strong></p>
<ul>
<li>In the VPC Services tab, click on <em>Internet Gateways</em></li>
<li>Click on <em>Create Internet Gateway</em>
<ul>
<li>give it a name (IGW-1) and <em>Create</em></li>
</ul>
</li>
<li>Once it is created, you should be on its configuration page:
<ul>
<li>click <em>Actions</em> and select <em>Attach to VPC</em></li>
<li>select your VPC 1 and <em>Attach</em></li>
</ul>
</li>
</ul>
<p>Now, your Internet Gateway belongs to your VPC environment, so we can set it up to route all Internet traffic.</p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em></li>
<li>On the Route Tables interface, look for your public route table:
<ul>
<li>select the public route table</li>
<li>on the panel at the bottom, click on <em>Routes</em> then <em>Edit routes</em></li>
<li>Click <em>Add route</em>, set the following:
<ul>
<li>Destination: 0.0.0.0/0   (0/0 means everywhere, it is not restricted to a specific network)</li>
<li>Target: Select Internet Gateway 1 from the drop-down</li>
</ul>
</li>
<li>Save the changes</li>
</ul>
</li>
</ul>
<p><strong>Create a private route table:</strong></p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em></li>
<li>Click on <em>Create Route Table</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PrivateRT-1)</li>
<li>Click <em>Create</em></li>
</ul>
</li>
<li>On the Route Tables interface, look for your route table:
<ul>
<li>select the route table</li>
<li>on the panel at the bottom, click on <em>Subnet Associations</em></li>
<li><em>Edit subnet associations</em> and select your private subnet 1 and <em>Save</em></li>
</ul>
</li>
</ul>
<p><strong>Create a private instance 1:</strong></p>
<ul>
<li>Go to EC2 Services and click on <em>Launch Instance</em>
<ul>
<li>select the 1st Amazon Linux AMI from the list</li>
<li>leave the Instance type as default and click <em>Next</em></li>
<li>Set the below:
<ul>
<li>Network: choose your VPC 1</li>
<li>Subnet: choose your private subnet 1</li>
<li>Auto-assign Public IP: Select <em>Disable</em></li>
<li>Leave the rest as default and go to the next page</li>
</ul>
</li>
<li>Leave Storage as default and go to the next page</li>
<li>In Tags, create a tag with <em>Key</em> : Name and <em>Value</em> : PrivateEC2-1&quot;</li>
<li>In the security group name the sg as <em>SG-Private-1</em> and for SSH rule, change the source to 10.100.0.0/24 (As we would only want to ssh to it from our public instances in our public subnet) and add a new rule for <em>ALL ICMP IPv4</em> and set the source to 10.100.0.0/16.</li>
<li>In the Review and Launch page, click <em>Launch</em> and select your KP that you created and stored locally during the Linux course
<em><strong>If you deleted your key pair, just create a new one and download it.</strong></em></li>
</ul>
</li>
</ul>
<p><strong>Create a public instance 1:</strong></p>
<ul>
<li>Go to EC2 Services and click on <em>Launch Instance</em>
<ul>
<li>select the 1st Amazon Linux AMI from the list</li>
<li>leave the Instance type as default and click <em>Next</em></li>
<li>Set the below:
<ul>
<li>Network: choose your VPC 1</li>
<li>Subnet: choose your public subnet 1</li>
<li>Auto-assign Public IP: Select <em>Enable</em></li>
<li>Leave the rest as default and go to the next page</li>
</ul>
</li>
<li>Leave Storage as default and go to the next page</li>
<li>In Tags, create a tag with <em>Key</em> : Name and <em>Value</em> : PublicEC2-1&quot;</li>
<li>In the security group name the sg as <em>SG-Public-1</em> and for SSH rule, change the source to MyIP.</li>
<li>In the Review and Launch page, click <em>Launch</em> and select the same KP as for the private instance</li>
</ul>
</li>
</ul>
<p>Now, you have to copy those steps to create the same environment in the second VPC, with the exception of the public instance because we will use the public instance in VPC-1 to login to the private instances of both VPC-1 and VPC-2, so a single public instance across 2 VPCs is enough in this context.</p>
<p><strong>Create a second VPC:</strong></p>
<ul>
<li>Login to your AWS account</li>
<li>Go to VPC Services and on the left panel, click on <em>Your VPCs</em></li>
<li>Click on <em>Create VPC</em> and give it a name (i.e. VPC-&ldquo;2&rdquo;) and a /16 CIDR block (i.e. 10.200.0.0/16), then leave the rest as default and click <em>Create VPC</em></li>
<li>Go back to the <em>Your VPCs</em> tab and check that your VPC has been created</li>
</ul>
<p><strong>Create a private subnet:</strong></p>
<ul>
<li>Go to VPC Services and on the left panel, click on <em>Subnets</em></li>
<li>Click on <em>Create Subnet</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PrivateSub-2)</li>
<li>choose one of the Availability Zones</li>
<li>Use the first /24 of your VPC CIDR (i.e. 10.200.1.0/24)</li>
<li>Click <em>Create Subnet</em></li>
</ul>
</li>
</ul>
<p><strong>Create a private route table:</strong></p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em></li>
<li>Click on <em>Create Route Table</em>
<ul>
<li>choose your VPC from the list</li>
<li>give it a name (PrivateRT-2)</li>
<li>Click <em>Create</em></li>
</ul>
</li>
<li>On the Route Tables interface, look for your route table:
<ul>
<li>select the route table</li>
<li>on the panel at the bottom, click on <em>Subnet Associations</em></li>
<li><em>Edit subnet associations</em> and select your private subnet 2 and <em>Save</em></li>
</ul>
</li>
</ul>
<p><strong>Create a private instance 2:</strong></p>
<ul>
<li>Go to EC2 Services and click on <em>Launch Instance</em>
<ul>
<li>select the 1st Amazon Linux AMI from the list</li>
<li>leave the Instance type as default and click <em>Next</em></li>
<li>Set the below:
<ul>
<li>Network: choose your VPC 2</li>
<li>Subnet: choose your private subnet 2</li>
<li>Auto-assign Public IP: Select <em>Disable</em></li>
<li>Leave the rest as default and go to the next page</li>
</ul>
</li>
<li>Leave Storage as default and go to the next page</li>
<li>In Tags, create a tag with <em>Key</em> : Name and <em>Value</em> : PrivateEC2-2&quot;</li>
<li>In the security group part add one port for ssh and another for ping, as below:
<strong>The security group of our second VPC should allow instances in VPC-1 to ping instances in VPC-2.</strong></li>
</ul>
<ul>
<li>Change source in the SSH rule to <em>10.100.0.0/16</em> and add another route for <em>ALL ICMP IPv4</em>, set the source to <em>10.100.0.0/16</em>.</li>
</ul>
<ul>
<li>In the Review and Launch page, click <em>Launch</em> and select the same KP as for previous instances</li>
</ul>
</li>
</ul>
<p><strong>Create a peering connection:</strong></p>
<ul>
<li>In the VPC Services tab:</li>
</ul>
<ul>
<li>In the navigation pane, choose Peering Connections, Create Peering Connection.</li>
<li>Configure the following information, and choose Create Peering Connection when you are done:</li>
<li>Peering connection name tag: You can optionally name your VPC peering connection.</li>
<li>VPC (Requester): Select the VPC in your account with which you want to create the VPC peering connection -&gt; <em>10.100.0.0/16</em> (VPC-1)</li>
<li>Under Select another VPC to peer with: Ensure My account is selected, and select another of your VPCs -&gt; <em>10.200.0.0/16</em> (VPC-2)</li>
<li>In the confirmation dialog box, choose OK.</li>
<li>Select the VPC peering connection that you&rsquo;ve created, and choose Actions, Accept Request.</li>
<li>In the confirmation dialog, choose Yes, Accept. A second confirmation dialog displays; choose Modify my route tables now to go directly to the route tables page, or choose Close and go to Route Tables.</li>
</ul>
<p>Note
If you cannot see the pending VPC peering connection, check the region. An inter-region peering request must be accepted in the region of the accepter VPC.
In the confirmation dialog box, choose Yes, Accept. A second confirmation dialog displays; choose Modify my route tables now to go directly to the route tables page, or choose Close and go to Route Tables.</p>
<p>Now we have to update the route tables to express the peering connection.</p>
<p>Add a Route in Public subnet of VPC 1 to connect to Private subnet in the VPC 2.</p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em>. Select the Route Table that is associated with the public subnet of the VPC 1.</li>
</ul>
<ul>
<li>on the panel at the bottom, click on <em>Routes</em> then <em>Edit routes</em>
<ul>
<li>Click <em>Add route</em>, set the following:
<ul>
<li>Destination: 10.200.1.0/24</li>
<li>Target: pcx-xxxxxxxx (select the peering connection you have just established)</li>
</ul>
</li>
<li>Save the changes</li>
</ul>
</li>
</ul>
<p>Add a Route in Private subnet of VPC 1 to connect to Private subnet in the VPC 2.</p>
<ul>
<li>In the VPC Services tab, click on <em>Route Tables</em>. Select the Route Table that is associated with the private subnet of the VPC 1.</li>
</ul>
<ul>
<li>on the panel at the bottom, click on <em>Routes</em> then <em>Edit routes</em>
<ul>
<li>Click <em>Add route</em>, set the following:
<ul>
<li>Destination: 10.200.1.0/24</li>
<li>Target: pcx-xxxxxxxx (select the peering connection you have just established)</li>
</ul>
</li>
<li>Save the changes</li>
</ul>
</li>
</ul>
<p>Now you&rsquo;ll have to do the same for the second VPC.</p>
<p>Select the Route Table that is associated with the private subnet of the VPC 2.</p>
<ul>
<li>on the panel at the bottom, click on <em>Routes</em> then <em>Edit routes</em>
<ul>
<li>Click <em>Add route</em>, set the following:
<ul>
<li>Destination: 10.100.0.0/16  <strong>(We are using the whole /16 because we want to include both private and public /24 subnets)</strong></li>
<li>Target: pcx-xxxxxxxx (select the peering connection you have just established)</li>
</ul>
</li>
<li>Save the changes</li>
</ul>
</li>
</ul>
<p>Now the architecture is set up. You can try ssh to the instances and try to ping them.</p>
<p><strong>Test public connectivity to your public instance:</strong></p>
<p>Look for the private IP address of the private instance in VPC-1 (In EC2 Services, check the bottom panel details of your instance), and write it down somewhere.
Look for the private IP address of the private instance in VPC-2 (In EC2 Services, check the bottom panel details of your instance), and write it down somewhere.</p>
<p>Now, copy the public IP of your public instance, login to it with SSH and run the below connectivity tests.</p>
<p><strong>Connectivity to the local (VPC-1) private instance by replacing X.X.X.X with its IP:</strong></p>
<pre><code class="language-commandline" data-lang="commandline">ping X.X.X.X
</code></pre><p><strong>Connectivity to the VPC-2 private instance by replacing Y.Y.Y.Y with its IP:</strong></p>
<pre><code class="language-commandline" data-lang="commandline">ping Y.Y.Y.Y
</code></pre><p>They should both ping! If not, it probably means that the problem is either in the SecurityGroups not allowing ICMP traffic, or that your route tables are not properly configured.</p>
<p>Otherwise, well done! Good job!</p>
<p><strong>Bonus Step</strong></p>
<p>You can use the public instance to jump into both private instances of VPC-1 and VPC-2 using SSH, given we can&rsquo;t access it publicly. In this case, we call this public instance a Bastion instance, it acts like a jump box.</p>
<p>If you manage to SSH to both instances, it proves your SSH communication across VPCs.</p>
<p>In order to jump into the private instances from the public instance, all the steps are detailed in this AWS page (both for MAC and Windows): <a href="https://aws.amazon.com/blogs/security/securely-connect-to-linux-instances-running-in-a-private-amazon-vpc/">https://aws.amazon.com/blogs/security/securely-connect-to-linux-instances-running-in-a-private-amazon-vpc/</a></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../day-3-aws-advanced-networking/vpc-peering.html" title="VPC Peering"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../day-3-aws-advanced-networking/transit-gateway.html" title="Transit Gateway" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js?1615889543"></script>
    <script src="../js/perfect-scrollbar.min.js?1615889543"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js?1615889543"></script>
    <script src="../js/jquery.sticky.js?1615889543"></script>
    <script src="../js/featherlight.min.js?1615889543"></script>
    <script src="../js/highlight.pack.js?1615889543"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js?1615889543"></script>
    <script src="../js/learn.js?1615889543"></script>
    <script src="../js/hugo-learn.js?1615889543"></script>

    <link href="../mermaid/mermaid.css?1615889543" rel="stylesheet" />
    <script src="../mermaid/mermaid.js?1615889543"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

